
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Likelihood Fitting of Tracer Luminosity Function &#8212; HorizonGRound 0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Modified Power Spectrum Multipoles" href="modified_power_spectrum_multipoles.html" />
    <link rel="prev" title="Forward Modelling from Tracer Luminosity Function" href="forward_modelling_from_LF.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/HorizonGRound.png" alt="Logo"/>
            </a></p><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../quick_recipes.html">Quick Recipes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="forward_modelling_from_LF.html">Forward Modelling from Tracer Luminosity Function</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Likelihood Fitting of Tracer Luminosity Function</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Load-luminosity-function-measurements">Load luminosity function measurements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Evaluate-luminosity-function-likelihood">Evaluate luminosity function likelihood</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="modified_power_spectrum_multipoles.html">Modified Power Spectrum Multipoles</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc.html">API Reference</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Likelihood-Fitting-of-Tracer-Luminosity-Function">
<h1>Likelihood Fitting of Tracer Luminosity Function<a class="headerlink" href="#Likelihood-Fitting-of-Tracer-Luminosity-Function" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we show how you can perform simple likelihood fitting to the tracer luminosity function (LF) using the <code class="docutils literal notranslate"><span class="pre">lumfunc_likelihood</span></code> module.</p>
<div class="section" id="Load-luminosity-function-measurements">
<h2>Load luminosity function measurements<a class="headerlink" href="#Load-luminosity-function-measurements" title="Permalink to this headline">¶</a></h2>
<p>To get hold of the demo data (a parameter file for the LF model), we use the <code class="docutils literal notranslate"><span class="pre">get_test_data_loc</span></code> function from the <code class="docutils literal notranslate"><span class="pre">utils</span></code> module.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">horizonground.utils</span> <span class="kn">import</span> <span class="n">get_test_data_loc</span>

<span class="n">demo_measurements_file</span> <span class="o">=</span> <span class="n">get_test_data_loc</span><span class="p">(</span><span class="s2">&quot;eBOSS_QSO_LF_measurements.txt&quot;</span><span class="p">)</span>
<span class="n">demo_uncertainties_file</span> <span class="o">=</span> <span class="n">get_test_data_loc</span><span class="p">(</span><span class="s2">&quot;eBOSS_QSO_LF_uncertainties.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Let’s have a preview of the files’ first few rows. Note the table headers format the column names as <code class="docutils literal notranslate"><span class="pre">&lt;lg_:optional&gt;Phi_z_&lt;zbin_min&gt;_&lt;zbin_max&gt;</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">demo_measurements_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">escapechar</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">demo_uncertainties_file</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">escapechar</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lg_Phi_z_0.68_1.06,</th>
      <th>lg_Phi_z_1.06_1.44,</th>
      <th>lg_Phi_z_1.44_1.82,</th>
      <th>lg_Phi_z_1.82_2.20,</th>
      <th>lg_Phi_z_2.20_2.60,</th>
      <th>lg_Phi_z_2.60_3.00,</th>
      <th>lg_Phi_z_3.00_3.50,</th>
      <th>lg_Phi_z_3.50_4.00</th>
    </tr>
    <tr>
      <th>magnitude,</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-28.8</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-8.34</td>
    </tr>
    <tr>
      <th>-28.4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-7.98</td>
      <td>-7.42</td>
      <td>-7.89</td>
      <td>-8.35</td>
    </tr>
    <tr>
      <th>-28.0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-7.63</td>
      <td>-7.49</td>
      <td>-7.10</td>
      <td>-7.33</td>
      <td>-8.36</td>
    </tr>
    <tr>
      <th>-27.6</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>-7.32</td>
      <td>-6.91</td>
      <td>-6.88</td>
      <td>-6.99</td>
      <td>-7.33</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>d_lg_Phi_z_0.68_1.06,</th>
      <th>d_lg_Phi_z_1.06_1.44,</th>
      <th>d_lg_Phi_z_1.44_1.82,</th>
      <th>d_lg_Phi_z_1.82_2.20,</th>
      <th>d_lg_Phi_z_2.20_2.60,</th>
      <th>d_lg_Phi_z_2.60_3.00,</th>
      <th>d_lg_Phi_z_3.00_3.50,</th>
      <th>d_lg_Phi_z_3.50_4.00</th>
    </tr>
    <tr>
      <th>magnitude,</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>-28.8</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>-28.4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.31</td>
      <td>0.17</td>
      <td>0.26</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>-28.0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.22</td>
      <td>0.18</td>
      <td>0.12</td>
      <td>0.14</td>
      <td>0.44</td>
    </tr>
    <tr>
      <th>-27.6</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.16</td>
      <td>0.11</td>
      <td>0.10</td>
      <td>0.11</td>
      <td>0.14</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">LumFuncMeasurements</span></code> class helps organise the data tables into luminosity and redshift bins. The <code class="docutils literal notranslate"><span class="pre">base10_log</span></code> boolean keyword parameter, if <code class="docutils literal notranslate"><span class="pre">True</span></code>, means the LF values will be converted to base 10 logarithms unless <code class="docutils literal notranslate"><span class="pre">'lg_'</span></code> is detected in the table column names (i.e. the raw data are already logarithmic). Please note that <em>naming your table columns as shown above</em> helps <code class="docutils literal notranslate"><span class="pre">LumFuncMeasurements</span></code> process the data labels <em>and</em> values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">from</span> <span class="nn">horizonground.lumfunc_likelihood</span> <span class="kn">import</span> <span class="n">LumFuncMeasurements</span>

<span class="n">LF_data</span> <span class="o">=</span> <span class="n">LumFuncMeasurements</span><span class="p">(</span><span class="n">demo_measurements_file</span><span class="p">,</span> <span class="n">demo_uncertainties_file</span><span class="p">,</span> <span class="n">base10_log</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pprint</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span>
    <span class="p">[</span><span class="s2">&quot;Luminosity bins&quot;</span><span class="p">,</span> <span class="s2">&quot;Redshift bin centres&quot;</span><span class="p">,</span> <span class="s2">&quot;Redshift bin labels&quot;</span><span class="p">],</span>
    <span class="p">[</span><span class="n">LF_data</span><span class="o">.</span><span class="n">luminosity_bins</span><span class="p">,</span> <span class="n">LF_data</span><span class="o">.</span><span class="n">redshift_bins</span><span class="p">,</span> <span class="n">LF_data</span><span class="o">.</span><span class="n">redshift_labels</span><span class="p">]</span>
<span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;Luminosity bins&#39;: array([-28.8, -28.4, -28. , -27.6, -27.2, -26.8, -26.4, -26. , -25.6,
       -25.2, -24.8, -24.4, -24. , -23.6, -23.2, -22.8, -22.4, -22. ,
       -21.6, -21.2, -20.8]),
 &#39;Redshift bin centres&#39;: array([0.87, 1.25, 1.63, 2.01, 2.4 , 2.8 , 3.25, 3.75]),
 &#39;Redshift bin labels&#39;: [&#39;$0.68&lt;z&lt;1.06$&#39;,
                         &#39;$1.06&lt;z&lt;1.44$&#39;,
                         &#39;$1.44&lt;z&lt;1.82$&#39;,
                         &#39;$1.82&lt;z&lt;2.20$&#39;,
                         &#39;$2.20&lt;z&lt;2.60$&#39;,
                         &#39;$2.60&lt;z&lt;3.00$&#39;,
                         &#39;$3.00&lt;z&lt;3.50$&#39;,
                         &#39;$3.50&lt;z&lt;4.00$&#39;]}
</pre></div></div>
</div>
<p>You can use either dictionary or slice syntax to access measurements and uncertainties in a particular redshift bin, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">measurements_in_bin</span><span class="p">,</span> <span class="n">uncertainties_in_bin</span> <span class="o">=</span> <span class="n">LF_data</span><span class="p">[</span><span class="s1">&#39;z=0.87&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Redshift bin z=0.87 measurements: &quot;</span><span class="p">,</span> <span class="n">measurements_in_bin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Redshift bin z=0.87 uncertainties: &quot;</span><span class="p">,</span> <span class="n">uncertainties_in_bin</span><span class="p">)</span>

<span class="n">measurements_in_bin</span><span class="p">,</span> <span class="n">uncertainties_in_bin</span> <span class="o">=</span> <span class="n">LF_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Third redshift bin measurements: &quot;</span><span class="p">,</span> <span class="n">measurements_in_bin</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Third redshift bin uncertainties: &quot;</span><span class="p">,</span> <span class="n">uncertainties_in_bin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Redshift bin z=0.87 measurements:  [  nan   nan   nan   nan   nan   nan -8.13 -6.94 -6.53 -6.32 -6.09 -5.81
 -5.76 -5.51 -5.45 -5.39 -5.45 -5.46   nan   nan   nan]
Redshift bin z=0.87 uncertainties:  [ nan  nan  nan  nan  nan  nan 0.44 0.12 0.09 0.08 0.07 0.06 0.06 0.05
 0.05 0.05 0.06 0.06  nan  nan  nan]
Third redshift bin measurements:  [  nan   nan   nan -7.32 -6.76 -6.51 -6.25 -6.1  -5.92 -5.68 -5.59 -5.52
 -5.42 -5.36 -5.3    nan   nan   nan   nan   nan   nan]
Third redshift bin uncertainties:  [ nan  nan  nan 0.16 0.09 0.08 0.07 0.06 0.06 0.05 0.05 0.05 0.05 0.05
 0.05  nan  nan  nan  nan  nan  nan]
</pre></div></div>
</div>
<p>Finally, it’s more useful to get the LF data vectors for measurements and uncertainties. We order the elements by redshift and then luminosity, with invalid values omitted. Note that the values are given in logarithm here, as the raw data have symmetric uncertainties in <span class="math notranslate nohighlight">\(\lg\varPhi\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_vector</span><span class="p">,</span> <span class="n">variance_vector</span> <span class="o">=</span> <span class="n">LF_data</span><span class="o">.</span><span class="n">get_statistics</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data vector: &quot;</span><span class="p">,</span> <span class="n">data_vector</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variance vector: &quot;</span><span class="p">,</span> <span class="n">variance_vector</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Data vector:  [-8.13 -6.94 -6.53 -6.32 -6.09 -5.81 -5.76 -5.51 -5.45 -5.39 -5.45 -5.46
 -8.2  -7.15 -6.59 -6.39 -6.15 -5.97 -5.78 -5.59 -5.5  -5.42 -5.34 -5.35
 -7.32 -6.76 -6.51 -6.25 -6.1  -5.92 -5.68 -5.59 -5.52 -5.42 -5.36 -5.3
 -7.63 -6.91 -6.63 -6.33 -6.17 -5.99 -5.77 -5.73 -5.6  -5.5  -5.41 -5.49
 -7.98 -7.49 -6.88 -6.67 -6.39 -6.18 -6.15 -5.96 -5.79 -5.66 -5.67 -5.62
 -7.42 -7.1  -6.99 -6.8  -6.57 -6.32 -6.16 -6.05 -5.93 -5.88 -5.81 -7.89
 -7.33 -7.33 -7.26 -6.75 -6.55 -6.37 -6.19 -6.23 -6.1  -8.34 -8.35 -8.36
 -7.49 -7.17 -6.71]
Variance vector:  [0.1936 0.0144 0.0081 0.0064 0.0049 0.0036 0.0036 0.0025 0.0025 0.0025
 0.0036 0.0036 0.1936 0.0196 0.0064 0.0049 0.0036 0.0036 0.0036 0.0025
 0.0025 0.0025 0.0025 0.0025 0.0256 0.0081 0.0064 0.0049 0.0036 0.0036
 0.0025 0.0025 0.0025 0.0025 0.0025 0.0025 0.0484 0.0121 0.0064 0.0049
 0.0036 0.0036 0.0025 0.0025 0.0025 0.0025 0.0025 0.0036 0.0961 0.0324
 0.01   0.0064 0.0049 0.0036 0.0036 0.0036 0.0036 0.0025 0.0025 0.0036
 0.0289 0.0144 0.0121 0.0081 0.0064 0.0049 0.0036 0.0036 0.0036 0.0036
 0.0036 0.0676 0.0196 0.0196 0.0169 0.0064 0.0049 0.0049 0.0036 0.0049
 0.0064 0.1936 0.1936 0.1936 0.0289 0.0169 0.01  ]
</pre></div></div>
</div>
</div>
<div class="section" id="Evaluate-luminosity-function-likelihood">
<h2>Evaluate luminosity function likelihood<a class="headerlink" href="#Evaluate-luminosity-function-likelihood" title="Permalink to this headline">¶</a></h2>
<p>We will consider the LF likelihood for the quasar PLE luminosity function and the following uniform prior parameter ranges.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">demo_prior_file</span> <span class="o">=</span> <span class="n">get_test_data_loc</span><span class="p">(</span><span class="s2">&quot;QSO_LF_PLE_model_prior.txt&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">demo_prior_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">prior_file</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">prior_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# m_\ast(z_\mathrm{p}), \lg\Phi_\ast, \alpha_\mathrm{l}, \alpha_\mathrm{h}, \beta_\mathrm{l}, \beta_\mathrm{h}, k_{1\mathrm{l}}, k_{1\mathrm{h}}, k_{2\mathrm{l}}, k_{2\mathrm{h}}
-29.  -8.  -10.  -5.  -3.  -3.  -1.5  -1.5  -1.5  -1.5
-22.  -5.   -0.  -0.  -0.  -0.   1.5   1.5   1.5   1.5

</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">LumFuncLikelihood</span></code> class provided likelihood evaluation tools. It is a derived class from <code class="docutils literal notranslate"><span class="pre">LumFuncMeasurements</span></code> so automatically handles the data vector as above. It also processes the prior file above into a dictionary of parameter names and parameter prior ranges. For the quasar PLE model which is a double power law, there is an exchange symmetry between the power-law indices <span class="math notranslate nohighlight">\(\alpha, \beta\)</span>. To avoid a redundant multi-modal posterior, we impose the constraint
<span class="math notranslate nohighlight">\(\alpha &lt; \beta\)</span> by passing the function <code class="docutils literal notranslate"><span class="pre">quasar_PLE_model_constraint</span></code> to the keyword parameter <code class="docutils literal notranslate"><span class="pre">model_constraint</span></code>. The log-likelihood is essentially a Gaussian quadratic form in a variable <span class="math notranslate nohighlight">\(\tilde{\varPhi} = f(\varPhi)\)</span> that is related to the luminosity function <span class="math notranslate nohighlight">\(\varPhi\)</span>; here we choose the Poisson prescption in Pozzetti et al. (2016) <a class="reference external" href="https://arxiv.org/abs/1603.01453">[arXiv: 1603.01453]</a>. For other prescriptions, please refer to Pozzetti et al. (2016) and the API
reference.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">horizonground.lumfunc_modeller</span> <span class="kn">import</span> <span class="n">quasar_PLE_lumfunc</span><span class="p">,</span> <span class="n">quasar_PLE_model_constraint</span>
<span class="kn">from</span> <span class="nn">horizonground.lumfunc_likelihood</span> <span class="kn">import</span> <span class="n">LumFuncLikelihood</span>

<span class="n">likelihood</span> <span class="o">=</span> <span class="n">LumFuncLikelihood</span><span class="p">(</span>
    <span class="n">quasar_PLE_lumfunc</span><span class="p">,</span>
    <span class="n">demo_measurements_file</span><span class="p">,</span>
    <span class="n">demo_prior_file</span><span class="p">,</span>
    <span class="n">uncertainty_file</span><span class="o">=</span><span class="n">demo_uncertainties_file</span><span class="p">,</span>
    <span class="n">fixed_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prescription</span><span class="o">=</span><span class="s1">&#39;poisson&#39;</span><span class="p">,</span>
    <span class="n">model_constraint</span><span class="o">=</span><span class="n">quasar_PLE_model_constraint</span><span class="p">,</span>
    <span class="n">model_options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;redshift_pivot&#39;</span><span class="p">:</span> <span class="mf">2.22</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>It is also worth noting that parameters which are not meant to be sampled but rather kept fixed can be passed using <code class="docutils literal notranslate"><span class="pre">fixed_file</span></code> (see below for an example). The <code class="docutils literal notranslate"><span class="pre">model_options</span></code> keyword parameter is reserved for other parameters not considered part of the parametric LF model per se but merely a parameter in the Python implementation, e.g. the pivot redshift or the conversion of LF to logarithmic values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">demo_fixed_file</span> <span class="o">=</span> <span class="n">get_test_data_loc</span><span class="p">(</span><span class="s2">&quot;QSO_LF_PLE_model_fixed.txt&quot;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">demo_fixed_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fixed_file</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">fixed_file</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
# m_\ast(z_\mathrm{p}), \lg\Phi_\ast, \alpha_\mathrm{l}, \alpha_\mathrm{h}, \beta_\mathrm{l}, \beta_\mathrm{h}, k_{1\mathrm{l}}, k_{1\mathrm{h}}, k_{2\mathrm{l}}, k_{2\mathrm{h}}
-26.71, -6.01, -4.31, -3.04, -1.54, -1.38, -0.08, -0.25, -0.40, -0.05

</pre></div></div>
</div>
<p>After constructing the likelihood class as above, it can be called just like a function, e.g. evaluated at the fixed parameter values above. We use the <code class="docutils literal notranslate"><span class="pre">load_parameter_set</span></code> function from the <code class="docutils literal notranslate"><span class="pre">utils</span></code> module to convert the parameter file above into a dictionary of parameter names and values at which the log-likelihood (essentially <span class="math notranslate nohighlight">\(-\chi^2\big/2\)</span>) is evaluated.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">horizonground.utils</span> <span class="kn">import</span> <span class="n">load_parameter_set</span>

<span class="n">parameter_point</span> <span class="o">=</span> <span class="n">load_parameter_set</span><span class="p">(</span><span class="n">demo_fixed_file</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">likelihood</span><span class="p">(</span><span class="n">parameter_point</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-78.13664554573882
</pre></div></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy; Copyright 2020, Mike Shengbo Wang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorials/likelihood_calculation_of_LF.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>